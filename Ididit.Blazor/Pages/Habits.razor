@page "/habits"
@page "/habits/{Id:long}"

@using Ididit.Data.Models
@using Ididit.Services

@inject HabitService HabitService

<PageTitle>Habits</PageTitle>

<h1>Habits</h1>

@if (HabitService.Habits is null || HabitService.NewHabit is null)
{
    <p>Loading...</p>
}
else
{
    <p>Habits: @HabitService.Habits.Count</p>

    foreach (HabitModel habit in HabitService.Habits.Where(h => !h.IsDeleted))
    {
        if (habit.Id == Id)
        {
            <p><a href="/habits">@habit.Title</a></p>

            <button @onclick="() => HabitService.DeleteHabit(habit.Id)">Delete Habit</button>

            <p>@habit.CreatedAt</p>
            <p>@habit.UpdatedAt</p>
            <p>@habit.Priority</p>
        }
        else
        {
            <p><a href="/habits/@habit.Id">@habit.Title</a></p>
        }
    }

    <div>
        <label for="titleInput">Title:</label>
        <input id="titleInput" type="text" @bind="HabitService.NewHabit.Title" />

        <button @onclick="HabitService.AddHabit">Add Habit</button>
    </div>
}

@code {
    [Parameter]
    public long? Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await HabitService.Initialize();
    }
}
